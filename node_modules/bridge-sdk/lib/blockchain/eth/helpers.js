"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getNetworkFee = exports.getGasPrice = void 0;
const tslib_1 = require("tslib");
const superagent_1 = tslib_1.__importDefault(require("superagent"));
const utils_1 = require("../../utils");
const BN = require('bn.js');
exports.getGasPrice = async (web3) => {
    const gasPrice = new BN(await web3.eth.getGasPrice()).mul(new BN(1));
    let gasPriceApi = 0;
    try {
        const info = await superagent_1.default.get(`https://data-api.defipulse.com/api/v1/egs/api/ethgasAPI.json?api-key=${process.env.ETH_GAS_API_KEY}`);
        gasPriceApi = utils_1.mulDecimals(info.body.average, 8);
    }
    catch (e) {
        console.error('Error get gas price');
    }
    const res = gasPrice.lt(gasPriceApi) ? gasPriceApi : gasPrice;
    return res;
};
exports.getNetworkFee = async (web3) => {
    const gasPrice = await exports.getGasPrice(web3);
    const gasLimit = new BN(50000);
    const fee = gasLimit.mul(gasPrice).mul(new BN(2));
    return Number(utils_1.divDecimals(fee, 18));
};
