{"ast":null,"code":"\"use strict\";\n/**\n * @packageDocumentation\n * @module harmony-network\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.HttpProvider = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar baseProvider_1 = require(\"./baseProvider\");\n\nvar defaultFetcher_1 = require(\"./defaultFetcher\");\n\nvar net_1 = require(\"../rpcMethod/net\");\n/** @hidden */\n\n\nvar defaultOptions = {\n  method: 'POST',\n  timeout: net_1.DEFAULT_TIMEOUT,\n  headers: net_1.DEFAULT_HEADERS,\n  user: null,\n  password: null\n};\n\nvar HttpProvider = function (_super) {\n  tslib_1.__extends(HttpProvider, _super);\n\n  function HttpProvider(url, options, fetcher) {\n    var _this = _super.call(this, url) || this;\n\n    _this.url = url || 'http://localhost:9500';\n    _this.fetcher = fetcher || defaultFetcher_1.fetchRPC;\n\n    if (options) {\n      _this.options = {\n        method: options.method || defaultOptions.method,\n        timeout: options.timeout || defaultOptions.timeout,\n        user: options.user || defaultOptions.user,\n        password: options.password || defaultOptions.password,\n        headers: options.headers || defaultOptions.headers\n      };\n    } else {\n      _this.options = defaultOptions;\n    }\n\n    return _this;\n  }\n  /**\n   * @function send\n   * @memberof HttpProvider.prototype\n   * @param  {Object} payload  - payload object\n   * @param  {Function} callback - callback function\n   * @return {any} - RPC Response\n   */\n\n\n  HttpProvider.prototype.send = function (payload, callback) {\n    return this.requestFunc({\n      payload: payload,\n      callback: callback\n    });\n  };\n  /**\n   * @function sendServer\n   * @memberof HttpProvider.prototype\n   * @param  {String} endpoint - endpoint to server\n   * @param  {Object} payload  - payload object\n   * @param  {Function} callback - callback function\n   * @return {Function} - RPC Response\n   */\n\n\n  HttpProvider.prototype.sendServer = function (endpoint, payload, callback) {\n    return this.requestFunc({\n      endpoint: endpoint,\n      payload: payload,\n      callback: callback\n    });\n  };\n\n  HttpProvider.prototype.requestFunc = function (_a) {\n    var _this = this;\n\n    var endpoint = _a.endpoint,\n        payload = _a.payload,\n        callback = _a.callback;\n\n    var _b = tslib_1.__read(this.getMiddleware(payload.method), 2),\n        tReq = _b[0],\n        tRes = _b[1];\n\n    var reqMiddleware = net_1.composeMiddleware.apply(void 0, tslib_1.__spread(tReq, [function (obj) {\n      return _this.optionsHandler(obj);\n    }, function (obj) {\n      return _this.endpointHandler(obj, endpoint);\n    }, this.payloadHandler]));\n    var resMiddleware = net_1.composeMiddleware.apply(void 0, tslib_1.__spread([function (data) {\n      return _this.callbackHandler(data, callback);\n    }], tRes));\n    var req = reqMiddleware(payload);\n    return net_1.performRPC(req, resMiddleware, this.fetcher);\n  };\n  /**\n   * @function payloadHandler\n   * @memberof HttpProvider.prototype\n   * @param  {Object} payload - payload object\n   * @return {Object} - to payload object\n   */\n\n\n  HttpProvider.prototype.payloadHandler = function (payload) {\n    return {\n      payload: payload\n    };\n  };\n  /**\n   * @function endpointHandler\n   * @memberof HttpProvider.prototype\n   * @param  {Object} obj      - payload object\n   * @param  {String} endpoint - add the endpoint to payload object\n   * @return {Object} - assign a new object\n   */\n\n\n  HttpProvider.prototype.endpointHandler = function (obj, endpoint) {\n    return tslib_1.__assign(tslib_1.__assign({}, obj), {\n      url: endpoint !== null && endpoint !== undefined ? \"\" + this.url + endpoint : this.url\n    });\n  };\n  /**\n   * @function optionsHandler\n   * @memberof HttpProvider.prototype\n   * @param  {object} obj - options object\n   * @return {object} - assign a new option object\n   */\n\n\n  HttpProvider.prototype.optionsHandler = function (obj) {\n    if (this.options.user && this.options.password) {\n      var AUTH_TOKEN = \"Basic \" + Buffer.from(this.options.user + \":\" + this.options.password).toString('base64');\n      this.options.headers.Authorization = AUTH_TOKEN;\n    }\n\n    return tslib_1.__assign(tslib_1.__assign({}, obj), {\n      options: this.options\n    });\n  };\n  /**\n   * @function callbackHandler\n   * @memberof HttpProvider.prototype\n   * @param  {Object} data - from server\n   * @param  {Function} cb   - callback function\n   * @return {Object|Function} - return object or callback function\n   */\n\n\n  HttpProvider.prototype.callbackHandler = function (data, cb) {\n    if (cb) {\n      cb(null, data);\n    }\n\n    return data;\n  };\n\n  HttpProvider.prototype.subscribe = function () {\n    throw new Error('HTTPProvider does not support subscriptions.');\n  };\n\n  HttpProvider.prototype.unsubscribe = function () {\n    throw new Error('HTTPProvider does not support subscriptions.');\n  };\n\n  return HttpProvider;\n}(baseProvider_1.BaseProvider);\n\nexports.HttpProvider = HttpProvider;","map":{"version":3,"sources":["../../src/providers/http.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\n/**\n * @packageDocumentation\n * @module harmony-network\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HttpProvider = void 0;\nvar tslib_1 = require(\"tslib\");\nvar baseProvider_1 = require(\"./baseProvider\");\nvar defaultFetcher_1 = require(\"./defaultFetcher\");\nvar net_1 = require(\"../rpcMethod/net\");\n/** @hidden */\nvar defaultOptions = {\n    method: 'POST',\n    timeout: net_1.DEFAULT_TIMEOUT,\n    headers: net_1.DEFAULT_HEADERS,\n    user: null,\n    password: null,\n};\nvar HttpProvider = /** @class */ (function (_super) {\n    tslib_1.__extends(HttpProvider, _super);\n    function HttpProvider(url, options, fetcher) {\n        var _this = _super.call(this, url) || this;\n        _this.url = url || 'http://localhost:9500';\n        _this.fetcher = fetcher || defaultFetcher_1.fetchRPC;\n        if (options) {\n            _this.options = {\n                method: options.method || defaultOptions.method,\n                timeout: options.timeout || defaultOptions.timeout,\n                user: options.user || defaultOptions.user,\n                password: options.password || defaultOptions.password,\n                headers: options.headers || defaultOptions.headers,\n            };\n        }\n        else {\n            _this.options = defaultOptions;\n        }\n        return _this;\n    }\n    /**\n     * @function send\n     * @memberof HttpProvider.prototype\n     * @param  {Object} payload  - payload object\n     * @param  {Function} callback - callback function\n     * @return {any} - RPC Response\n     */\n    HttpProvider.prototype.send = function (payload, callback) {\n        return this.requestFunc({ payload: payload, callback: callback });\n    };\n    /**\n     * @function sendServer\n     * @memberof HttpProvider.prototype\n     * @param  {String} endpoint - endpoint to server\n     * @param  {Object} payload  - payload object\n     * @param  {Function} callback - callback function\n     * @return {Function} - RPC Response\n     */\n    HttpProvider.prototype.sendServer = function (endpoint, payload, callback) {\n        return this.requestFunc({ endpoint: endpoint, payload: payload, callback: callback });\n    };\n    HttpProvider.prototype.requestFunc = function (_a) {\n        var _this = this;\n        var endpoint = _a.endpoint, payload = _a.payload, callback = _a.callback;\n        var _b = tslib_1.__read(this.getMiddleware(payload.method), 2), tReq = _b[0], tRes = _b[1];\n        var reqMiddleware = net_1.composeMiddleware.apply(void 0, tslib_1.__spread(tReq, [function (obj) { return _this.optionsHandler(obj); },\n            function (obj) { return _this.endpointHandler(obj, endpoint); }, this.payloadHandler]));\n        var resMiddleware = net_1.composeMiddleware.apply(void 0, tslib_1.__spread([function (data) { return _this.callbackHandler(data, callback); }], tRes));\n        var req = reqMiddleware(payload);\n        return net_1.performRPC(req, resMiddleware, this.fetcher);\n    };\n    /**\n     * @function payloadHandler\n     * @memberof HttpProvider.prototype\n     * @param  {Object} payload - payload object\n     * @return {Object} - to payload object\n     */\n    HttpProvider.prototype.payloadHandler = function (payload) {\n        return { payload: payload };\n    };\n    /**\n     * @function endpointHandler\n     * @memberof HttpProvider.prototype\n     * @param  {Object} obj      - payload object\n     * @param  {String} endpoint - add the endpoint to payload object\n     * @return {Object} - assign a new object\n     */\n    HttpProvider.prototype.endpointHandler = function (obj, endpoint) {\n        return tslib_1.__assign(tslib_1.__assign({}, obj), { url: endpoint !== null && endpoint !== undefined ? \"\" + this.url + endpoint : this.url });\n    };\n    /**\n     * @function optionsHandler\n     * @memberof HttpProvider.prototype\n     * @param  {object} obj - options object\n     * @return {object} - assign a new option object\n     */\n    HttpProvider.prototype.optionsHandler = function (obj) {\n        if (this.options.user && this.options.password) {\n            var AUTH_TOKEN = \"Basic \" + Buffer.from(this.options.user + \":\" + this.options.password).toString('base64');\n            this.options.headers.Authorization = AUTH_TOKEN;\n        }\n        return tslib_1.__assign(tslib_1.__assign({}, obj), { options: this.options });\n    };\n    /**\n     * @function callbackHandler\n     * @memberof HttpProvider.prototype\n     * @param  {Object} data - from server\n     * @param  {Function} cb   - callback function\n     * @return {Object|Function} - return object or callback function\n     */\n    HttpProvider.prototype.callbackHandler = function (data, cb) {\n        if (cb) {\n            cb(null, data);\n        }\n        return data;\n    };\n    HttpProvider.prototype.subscribe = function () {\n        throw new Error('HTTPProvider does not support subscriptions.');\n    };\n    HttpProvider.prototype.unsubscribe = function () {\n        throw new Error('HTTPProvider does not support subscriptions.');\n    };\n    return HttpProvider;\n}(baseProvider_1.BaseProvider));\nexports.HttpProvider = HttpProvider;\n//# sourceMappingURL=http.js.map"]},"metadata":{},"sourceType":"script"}